<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>Dashboard Loading Test</h1>
    
    <div class="test-section">
        <h2>1. Firebase Auth Test</h2>
        <button onclick="testAuth()">Test Authentication</button>
        <div id="auth-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Component Registration Test</h2>
        <button onclick="testComponents()">Test Components</button>
        <div id="component-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Dashboard Overview Test</h2>
        <button onclick="testDashboardOverview()">Test Dashboard Overview</button>
        <div id="dashboard-log" class="log"></div>
        <div id="dashboard-container"></div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { getCurrentUser, isAuthenticated } from '/firebase/auth.js';
        import { getProducts, getUserProfile } from '/firebase/firestore.js';
        
        // Make functions globally available
        window.testAuth = async function() {
            const log = document.getElementById('auth-log');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `[${timestamp}] <span class="${type}">${message}</span>\n`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                addLog('Testing Firebase Authentication...', 'info');
                
                // Test if auth is available
                addLog('Checking if auth is available...', 'info');
                const currentUser = getCurrentUser();
                addLog(`Current user: ${currentUser ? 'Authenticated' : 'Not authenticated'}`, currentUser ? 'success' : 'warning');
                
                if (currentUser) {
                    addLog(`User ID: ${currentUser.uid}`, 'success');
                    addLog(`User Email: ${currentUser.email}`, 'success');
                    addLog(`Display Name: ${currentUser.displayName || 'Not set'}`, 'success');
                }
                
                const isAuth = isAuthenticated();
                addLog(`isAuthenticated(): ${isAuth}`, isAuth ? 'success' : 'warning');
                
            } catch (error) {
                addLog(`Error testing auth: ${error.message}`, 'error');
                console.error('Auth test error:', error);
            }
        };
        
        window.testComponents = function() {
            const log = document.getElementById('component-log');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `[${timestamp}] <span class="${type}">${message}</span>\n`;
                log.scrollTop = log.scrollHeight;
            }
            
            addLog('Testing component registration...', 'info');
            
            const components = [
                'student-dashboard-overview',
                'student-dashboard',
                'student-sidebar',
                'student-products',
                'student-profile',
                'student-notifications',
                'student-purchases',
                'student-sales',
                'student-settings',
                'student-add-product'
            ];
            
            components.forEach(componentName => {
                const isRegistered = customElements.get(componentName);
                addLog(`${componentName}: ${isRegistered ? '✅ Registered' : '❌ Not registered'}`, 
                       isRegistered ? 'success' : 'error');
            });
        };
        
        window.testDashboardOverview = async function() {
            const log = document.getElementById('dashboard-log');
            const container = document.getElementById('dashboard-container');
            log.innerHTML = '';
            container.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `[${timestamp}] <span class="${type}">${message}</span>\n`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                addLog('Testing Dashboard Overview component...', 'info');
                
                // Check if component is registered
                if (!customElements.get('student-dashboard-overview')) {
                    addLog('❌ student-dashboard-overview component not registered', 'error');
                    return;
                }
                
                addLog('✅ student-dashboard-overview component is registered', 'success');
                
                // Create the component
                const overviewComponent = document.createElement('student-dashboard-overview');
                container.appendChild(overviewComponent);
                
                addLog('✅ Component created and added to DOM', 'success');
                
                // Wait a bit and check if it shows the no data message
                setTimeout(() => {
                    const shadowRoot = overviewComponent.shadowRoot;
                    if (shadowRoot) {
                        const content = shadowRoot.querySelector('.dashboard-overview');
                        if (content) {
                            const hasNoDataMessage = content.innerHTML.includes('No data available');
                            addLog(`Content loaded: ${hasNoDataMessage ? '❌ Shows no data message' : '✅ Shows dashboard content'}`, 
                                   hasNoDataMessage ? 'error' : 'success');
                            
                            if (hasNoDataMessage) {
                                addLog('This indicates an authentication or data loading issue', 'warning');
                            }
                        } else {
                            addLog('❌ Could not find dashboard content', 'error');
                        }
                    } else {
                        addLog('❌ Could not access shadow root', 'error');
                    }
                }, 2000);
                
            } catch (error) {
                addLog(`Error testing dashboard overview: ${error.message}`, 'error');
                console.error('Dashboard overview test error:', error);
            }
        };
        
        // Auto-run tests after page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testComponents();
            }, 1000);
        });
    </script>
</body>
</html> 