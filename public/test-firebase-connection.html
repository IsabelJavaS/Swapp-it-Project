<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Firebase Connection Test</h1>
    
    <div class="test-section">
        <h2>1. Firebase Configuration Test</h2>
        <button onclick="testFirebaseConfig()">Test Firebase Config</button>
        <div id="configLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Authentication Test</h2>
        <button onclick="testAuth()">Test Authentication</button>
        <div id="authLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Firestore Test</h2>
        <button onclick="testFirestore()">Test Firestore</button>
        <div id="firestoreLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>4. User Registration Test</h2>
        <input type="email" id="testEmail" placeholder="Test email" value="test@example.com">
        <input type="password" id="testPassword" placeholder="Test password" value="123456">
        <button onclick="testUserRegistration()">Test User Registration</button>
        <div id="registrationLog" class="log"></div>
    </div>

    <script type="module">
        import { auth, db } from './firebase/config.js';
        import { registerUser } from './firebase/auth.js';
        import { createUserProfile } from './firebase/firestore.js';

        window.testFirebaseConfig = function() {
            const log = document.getElementById('configLog');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                addLog('Testing Firebase configuration...', 'info');
                
                if (auth) {
                    addLog('✅ Firebase Auth initialized successfully', 'success');
                } else {
                    addLog('❌ Firebase Auth not initialized', 'error');
                }
                
                if (db) {
                    addLog('✅ Firestore initialized successfully', 'success');
                } else {
                    addLog('❌ Firestore not initialized', 'error');
                }
                
                addLog(`Auth domain: ${auth?.config?.authDomain || 'Not available'}`, 'info');
                addLog(`Project ID: ${auth?.config?.projectId || 'Not available'}`, 'info');
                
            } catch (error) {
                addLog(`❌ Error testing Firebase config: ${error.message}`, 'error');
            }
        };

        window.testAuth = function() {
            const log = document.getElementById('authLog');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                addLog('Testing Firebase Authentication...', 'info');
                
                // Test auth state
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        addLog(`✅ User authenticated: ${user.email}`, 'success');
                        addLog(`User ID: ${user.uid}`, 'info');
                    } else {
                        addLog('ℹ️ No user currently authenticated', 'info');
                    }
                });
                
            } catch (error) {
                addLog(`❌ Error testing auth: ${error.message}`, 'error');
            }
        };

        window.testFirestore = function() {
            const log = document.getElementById('firestoreLog');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                addLog('Testing Firestore connection...', 'info');
                
                // Test a simple read operation
                const testDoc = db.collection('test').doc('connection-test');
                testDoc.get().then((doc) => {
                    if (doc.exists) {
                        addLog('✅ Firestore read operation successful', 'success');
                    } else {
                        addLog('ℹ️ Test document does not exist (this is normal)', 'info');
                    }
                }).catch((error) => {
                    addLog(`❌ Firestore read error: ${error.message}`, 'error');
                });
                
            } catch (error) {
                addLog(`❌ Error testing Firestore: ${error.message}`, 'error');
            }
        };

        window.testUserRegistration = async function() {
            const log = document.getElementById('registrationLog');
            log.innerHTML = '';
            
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
                log.scrollTop = log.scrollHeight;
            }
            
            try {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                
                addLog(`Testing user registration with email: ${email}`, 'info');
                
                // Test user registration
                const authResult = await registerUser(email, password, 'Test User');
                
                if (authResult.success) {
                    addLog('✅ User account created successfully in Firebase Auth', 'success');
                    addLog(`User ID: ${authResult.user.uid}`, 'info');
                    
                    // Test profile creation
                    const userData = {
                        uid: authResult.user.uid,
                        email: email,
                        role: 'personal',
                        nombre: 'Test User',
                        telefono: '123456789',
                        direccion: 'Test Address',
                        colegio: 'Test School',
                        swappitCoins: 100,
                        isActive: true
                    };
                    
                    addLog('Testing user profile creation in Firestore...', 'info');
                    const profileResult = await createUserProfile(userData);
                    
                    if (profileResult.success) {
                        addLog('✅ User profile created successfully in Firestore', 'success');
                    } else {
                        addLog(`❌ Failed to create user profile: ${profileResult.error}`, 'error');
                    }
                    
                } else {
                    addLog(`❌ Failed to create user account: ${authResult.error}`, 'error');
                }
                
            } catch (error) {
                addLog(`❌ Error during registration test: ${error.message}`, 'error');
            }
        };
    </script>
</body>
</html> 